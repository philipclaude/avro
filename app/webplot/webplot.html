<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "~//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html id="mainBody">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!-- needed for collapsing -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <title>
      webplot
    </title>

    <link rel="shortcut icon" href="favicon.ico">

    <script type="text/javascript" src="../wv/webgl-utils.js"> </script>
    <script type="text/javascript" src="../wv/webgl-debug.js"> </script>
    <script type="text/javascript" src="../wv/J3DIMath.js">    </script>

    <script>
      var   wv   = {};            // object to store "globals"
      var   listener = {};
      var   elemsizes = {};
    </script>
    <script type="text/javascript" src="../wv/draw.js">     </script>
    <script type="text/javascript" src="../wv/render.js">   </script>
    <script type="text/javascript" src="../wv/primitive.js">    </script>
    <script type="text/javascript" src="../wv/scene.js">   </script>
    <script type="text/javascript" src="../wv/socket.js">   </script>
    <script type="text/javascript" src="../wv/callbacks.js"> </script>

    <script type="text/javascript" src="avro.js"> </script>
    <script type="text/javascript" src="interface.js"> </script>
    <script type="text/javascript" src="tree.js"> </script>
    <script type="text/javascript" src="terminal.js"> </script>
    <script type="text/javascript" src="listener.js"> </script>

    <script type="text/javascript">

      getSocketsURL = function(url)
      {
        // set our callback functions
        var url = prompt("Enter hostname:port", "ws://wazowski.middlebury.edu:7681");
        wv.getSockets(url);
        wv.setCallback("InitUI",        wvInitUI);
        wv.setCallback("UpdateUI",      wvUpdateUI);
        wv.setCallback("ServerMessage", wvServerMessage);
        wv.setCallback("UpdateCanvas",  wvUpdateCanvas);
        wv.setCallback("OnOpen",wvClientConnected);
        wv.Start();
        print_message("connected to "+url+"!","green");
        wv.url = url;
      }
      reconnectSocketsURL = function()
      {
        // set our callback functions
        var url = wv.url;
        wv.getSockets(url);
        wv.setCallback("InitUI",        wvInitUI);
        wv.setCallback("UpdateUI",      wvUpdateUI);
        wv.setCallback("ServerMessage", wvServerMessage);
        wv.setCallback("UpdateCanvas",  wvUpdateCanvas);
        wv.setCallback("OnOpen",wvClientConnected);
        wv.Start();
      }
    </script>

    <script>
      "use strict";

      wv.zNear    =  1.0;           // have some values for Zscreen
      wv.zFar     = 11.0;
      wv.canvasID = "WebViewer";    // must match canvas id=... below

      wv.mode4d = false;
      wv.colorbar = undefined;
      wv.colorbarlims = new Float32Array(2);

      // initialize websockets
      wv.getSockets("ws://Localhost:7681");

      wv.setCallback("InitUI",        wvInitUI);
      wv.setCallback("UpdateUI",      wvUpdateUI);
      wv.setCallback("ServerMessage", wvServerMessage);
      wv.setCallback("UpdateCanvas",  wvUpdateCanvas);
      wv.setCallback("OnOpen",wvClientConnected);
      var myTree = new Tree(document,"myTree");

    </script>

    <!-- toggle canvas darkness function -->
    <script type="text/javascript">

      toggle_darkness = function(e)
      {
        var cbox = document.getElementById("background-checkbox");
        var canvas = document.getElementById("WebViewer");
        if (cbox.checked)
          canvas.style.background = '#585C5C';
        else
          canvas.style.background = '#ffffff';
      }

      change_colormap = function()
      {
        var value = document.getElementById('colormap-select').value;
        wv.socketUt.send("colormap|"+value);
        if (wv.colorbar!=undefined)
          wv.socketUt.send("colorbar|10|-1");
      }

      toggle_colorbar = function(iplot)
      {
        /*var box = document.getElementById('colorbar-checkbox');
        if (box.checked)
          wv.socketUt.send("colorbar|10|"+iplot.toString()); // ask for 10 values
        else
          wv.colorbar = undefined;*/
        var box = document.getElementById('colorbar-checkbox-'+iplot.toString());
        if (box.checked)
          wv.socketUt.send("colorbar|10|"+iplot.toString()); // ask for 10 values
        else
          wv.colorbar = undefined;
      }

      load_tree = function()
      {
        wv.socketUt.send("getTree|");
      }

      slice_request = function()
      {
        // get the values in the 4d controls boxes
        var d = Number(document.getElementById('control4d-distance').value);
        var plane = document.getElementById('hyperplane-select').value;

        var reply = "slice4d|"+plane+"|"+d.toString();
        clear_plots();
        wv.socketUt.send(reply);
        alert('4d slicing is currently disabled!');
        //alert('please wait for the server to finish\nand re-load the plot tree!');
      }

    </script>

    <link rel="stylesheet" type="text/css" href="avro.css"/>

  </head>

    <body onload=wv.Start();resize_frames();listener.initialize();>

      <div id="tlframe" oncontextmenu="return false;">
        <hr>
          <!-- viewer control buttons -->
          <p align="center">
            <button title="Home (front) view"      type="button" id="homeButton"  onclick="cmdHome()">H          </button>
            <button title="Left side view"         type="button" id="leftButton"  onclick="cmdLeft()">L          </button>
            <button title="Right side view"        type="button" id="riteButton"  onclick="cmdRite()">R          </button>
            <button title="Bottom view"            type="button" id="botmButton"  onclick="cmdBotm()">B          </button>
            <button title="Top view"               type="button" id="topButton"   onclick="cmdTop()" >T          </button>
            <button title="Zoom in"                type="button" id="inButton"    onclick="cmdIn()"  >+          </button>
            <button title="Zoom out"               type="button" id="outButton"   onclick="cmdOut()" >-          </button>
            <button title="Connect WebSocket"      type="button" id="getSocketsURL"   onclick="getSocketsURL()" >WS         </button>
            <button title="Reconnect"      type="button" id="reconnectSocketsURL"   onclick="reconnectSocketsURL()" >&#8634;         </button>
          </p>
        <hr>

        <div class="panel-group" id="accordion">

          <!-- plots -->
         <div class="panel panel-default">
           <div class="panel-heading">
               <a data-toggle="collapse" data-parent="#accordion" href="#plot_collapse">
                 Plots
               </a>
           </div>
           <div class="panel-collapse collapse" id="plot_collapse">
             <br>
             <p align="right">
               <b>colormap:</b>&nbsp;
               <select name="colormap" id="colormap-select" value="giraffe" onchange="change_colormap()">
                 <option value="viridis">viridis</option>
                 <option value="parula">parula</option>
                 <option value="hsv">hsv</option>
                 <option value="jet">jet</option>
                 <option value="bwr">bwr</option>
                 <option value="bgr">bgr</option>
                 <option value="hot">hot</option>
                 <option value="giraffe" selected="selected">giraffe</option>
               </select>
               &nbsp;&nbsp;
               &nbsp;&nbsp;
               <button title="Update" type="button" id="load-tree-button" onclick="load_tree()">load</button>
               <button title="Clear" type="button" id="clear-plots-button" onclick="clear_plots()">clear</button>
               &nbsp;&nbsp;
             </p>

             <p align="right">
             <input type="checkbox" id="background-checkbox" onclick=toggle_darkness() title="toggle darkness">
             <b>dark background</b>
            </p>
             <hr>
            <div id="treefrm" oncontextmenu="return false;">
            </div>
           </div>
         </div> <!-- plots -->

         <!-- tools -->
         <div class="panel panel-default">
           <div class="panel-heading">
               <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                 Tools
               </a>
           </div>
           <div id="collapse3" class="panel-collapse collapse">
             <div class="panel-body">
               <p>
                 <b>clipping plane:</b>
               </p>
               <input title="show clipping plane" type="checkbox" id="plot-clip" onclick="plot_clip()" checked>&nbsp;show</input>
               <input title="flip clipping side" type="checkbox" id="flip-clip" checked="false">&nbsp;flip</input>
               <input title="check for real-time clipping" type="checkbox" id="real-time" checked="false">&nbsp;real-time</input>
               <div style="white-space:nowrap"></div>
             <div style="white-space:nowrap">
               &theta;&nbsp;<input style="width:150px; display: inline-block" align="left" type="range" oninput="plot_clip()" id="clip-alpha" name="alpha" , min="-90" max="90", step="1" value="0">
               &phi;&nbsp;<input style="width:150px; display: inline-block" align="right" type="range" oninput="plot_clip()" id="clip-beta" name="beta" , min="-90" max="90", step="1" value="0">
             </div>
                <div style="width:20%; display: inline-block" align="left">
                  offset
                  <input type="number" oninput="plot_clip()" id="clip-offset" name="x" min="-10000" max="10000" step=".1" VALUE="0" SIZE="1" style="width:100%">
                </div>
                <div style="width:75%; display: inline-block" align="right">
                  <button title="reset" type="button" id="reset-clip" onclick="reset_clip()">reset</button>
                  <button title="clip" type="button" id="request-clip" onclick="request_clip()">clip</button>
                </div>
                <hr>
                <div position="relative" style="width:100%; display: inline-block;">
                  <p>
                    <b>extract 4d mesh:</b>
                  </p>
                  &nbsp;&nbsp;offset: &nbsp;
                  <input id="control4d-distance" type="number"min="-10000" max="10000" step=".1" VALUE="0" SIZE="1" style="width:20%">
                  &nbsp;&nbsp; plane: &nbsp;
                  <select name="hyperplane4d" id="hyperplane-select" value="T" style="width:50px; display:inline-block;">
                    <option value="X">X</option>
                    <option value="Y">Y</option>
                    <option value="Z">Z</option>
                    <option value="T" selected="selected">T</option>
                  </select>
                  &nbsp;&nbsp;
                  <button onclick="slice_request()" style="display: inline-block;">apply</button>

               </div>
             </div>
           </div>

         </div> <!-- tools -->

       </div>  <!-- accordian -->

     </div> <!--tlfrm -->


      <!-- frame holding the webgl canvas -->
      <div id="trframe", oncontextmenu="return false;">
        <canvas id="WebViewer">
          If you are seeing this, your web browser does not support the &lt;canvas&gt; element.
        </canvas>
        <div id="colorbar-text-lo" class="over"></div>
        <div id="colorbar-text-hi" class="over"></div>
      </div>

    <script type="text/javascript">
      terminal = InitTerminal();
      var term = document.getElementById("brframe");
      term.set_listener(listener);
      window.addEventListener("resize", resize_frames );
      resize_frames();
    </script>

  </body>
</html>
